@page "/postcreation"
@using Microsoft.AspNetCore.Components.Forms
@using Pura.Services  <!-- Make sure this matches your CmdStorage namespace -->

@inject CmdStorage CmdStorage

<PageTitle>Create Post</PageTitle>

<h1>Create a new market listing</h1>

<EditForm Model="@postModel"
          OnValidSubmit="HandleValidSubmit">
    <DataAnnotationsValidator />
    <ValidationSummary />

    <div class="mb-3">
        <label for="title" class="form-label">Title</label>
        <InputText id="title" class="form-control" @bind-Value="postModel.Title" />
    </div>

    <div class="mb-3">
        <label for="description" class="form-label">Description</label>
        <InputTextArea id="description" class="form-control" @bind-Value="postModel.Description" />
    </div>

    <div class="mb-3">
        <label for="price" class="form-label">Price</label>
        <InputNumber id="price" class="form-control" @bind-Value="postModel.Price" />
    </div>

    <button type="submit" class="go-btn">Submit</button>
</EditForm> 

<div class="go-btn">
    <NavLink class="nav-link" href="Market">
        <span class="bi bi-plus-square-fill-nav-menu" aria-hidden="true"></span> Cancel and return to Market
    </NavLink>
</div>

@if (!string.IsNullOrEmpty(Message))
{
    <div class="alert @(Message.StartsWith("Error") ? "alert-danger" : "alert-success") mt-3">
        @Message
    </div>
}

@code {
    private PostModel postModel = new();
    private string? Message;

    private async Task HandleValidSubmit()
    {
        try
        {
            await CmdStorage.InsertProductAsync(
                name: postModel.Title,
                price: postModel.Price,
                description: postModel.Description
            );

            Message = "Post created successfully!";
            postModel = new(); // Reset form
        }
        catch (Exception ex)
        {
            Message = $"Error: {ex.Message}";
        }
    }

    public class PostModel
    {
        public string Title { get; set; } = string.Empty;
        public string Description { get; set; } = string.Empty;
        public decimal Price { get; set; }
    }
}